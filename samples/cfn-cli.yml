# Configuration file version, mandatory. 
Version: 2

# Default values for all stacks in this configuration file, 
# can be overwritten in environment stacks.
Defaults:
  
  # Stack configuration
  Stack:
    
    # AWS CLI profile name.
    # Optional, use default profile if this is not specified
    Profile: default
    
    # AWS region name for the stack
    Region: us-east-1

    # Template file location, sepecify a local file using relative path,
    # or s3 location (recorgnized automaticlly).
    Template: https://s3.amazonaws.com/quickstart-reference/linux/bastion/latest/templates/linux-bastion-master.templatea

    # Canned stack policy, possible values are:
    #   - DENY_ALL : deny all modify/delete
    #   - DENY_DELETE: deny all delete
    #   - ALLOW_ALL: allow all updates
    #   - Local file: stack policy json file
    StackPolicy: DENY_ALL
    
    # XXX: policy s3 url, tbd...
    StackPolicyURL:
    
    # List of stack capabilities, possible values are:
    #   - CAPABILITY_IAM: accesskeys, IAM user&groups, IAM roles&policy 
    #   - CAPABILITY_NAMED_IAM: IAM resources with custom names
    Capabilities: [CAPABILITY_IAM]
    
    # ARN of an IAM role that CloudFormation assumes when operating the stack.
    # If no value is specified, CloudFormatino uses a temporary session which 
    # generated form caller's credentials
    RoleARN: 'arn:aws:iam::${AWS_ACCOUNT_ID}:role/StackRole' 
    
    # A list of template resources which is allowed for stack creation:
    #   - AWS::* : all AWS resource
    #   - Custom:* : all custom resources
    #   - AWS::EC2::* : all resources of EC2 service
    #   - AWS::EC2::Instance : specific AWS resource
    # This value is used by IAM policy condition keys. 
    # By default, all resource types are allowed.
    ResourceTypes:
    
    # List of SNS ARNs to publish stack related events.
    NotificationARNs: ['arn:aws:sns::xxxxx']
    
    # XXX: new feature, tbd...
    RollbackConfiguration:
      RollbackTriggers: [ '' ]
      MonitoringTimeInMinutes: 3
    
    # Automatically package local resources to s3. 
    #
    # These are supported automaticlly by aws cloudformation package command:
    #   - BodyS3Location property for the AWS::ApiGateway::RestApi resource
    #   - Code property for the AWS::Lambda::Function resource
    #   - CodeUri property for the AWS::Serverless::Function resource
    #   - DefinitionUri property for the AWS::Serverless::Api resource
    #   - SourceBundle  property for the AWS::ElasticBeanstalk::Application-Version resource
    #   - TemplateURL property for the AWS::CloudFormation::Stack resource
    #
    # XXX: need scan template file, TBD ~
    # These are implemented using Transform::Include:
    #   - DefinitionBody property for AWS::Serverless::Api resource
    #   - PolicyDocument property for IAM resources
    #   - DefinitionString property for AWS::StepFunctions::StateMachine resource
    #   - Sql property for IoT, Kinesis analytics and Glue resource
    Package: true
    
    # S3 bucket name for packaging artifacts.
    # Default value is awscfncli-${AWS_ACCOUNT_ID}-${AWS_REGION}.
    # The bucket will be automaticlly created with default encryption enabled.
    ArtifactStorage: 
    
    # Whether to enable termination protection on the stack, default is false.
    EnableTerminationProtection: false
    
    # Tags to associate with this stack
    Tags:
      project: Booba
      cost-unit: 1B0

    # Input parameters for the stack.
    # XXX: how to support shell environment variables?
    Parameters:
      VPCCIDR:                10.16.32.0/20
      PublicSubnet1CIDR:      10.16.32.0/24
      PublicSubnet2CIDR:      10.16.33.0/24
      PrivateSubnet1CIDR:     10.16.40.0/24
      PrivateSubnet2CIDR:     10.16.41.0/24
      RemoteAccessCIDR:       23.45.67.89/32
      
      BastionAMIOS:           Amazon-Linux-HVM
      BastionInstanceType:    t2.micro
      NumBastionHosts:        1
      EnableBanner:           false
      EnableTCPForwarding:    true
      EnableX11Forwarding:    false

Environments:
  
  # Environment name
  staging:
    
    # Stack name
    IslandVpc:
      
      # Overwride stack parameters
      profile: StagingAccount
      region: us-east-1

      tags:
        environment: staging
        
      parameters:
        AvailabilityZones:    us-east-1a,us-east-1c
        KeyPairName:          key1

  # Environment name
  production:
    
    # Stack name
    IslandVpc:
      
      # Override stack parameters
      profile: ProductionAccountOperator
      region: us-east-1
      
      # Override stack tags
      tags:
        environment: s
        
      parameters:
        AvailabilityZones:    us-east-1a,us-east-1c
        KeyPairName:          key2

